<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login Credential Management Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            background: #f9f9f9;
            border-left: 4px solid #8b5cf6;
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .pass {
            background: #d4edda;
            color: #155724;
        }
        .fail {
            background: #f8d7da;
            color: #721c24;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
        }
        button {
            background: #8b5cf6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #7c3aed;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üß™ Login Credential Management Test</h1>
        <p>This page tests the browser credential management features implemented in login.html</p>

        <div class="test-section">
            <h2>Test 1: Autocomplete Attributes</h2>
            <div id="test1-result"></div>
            <button onclick="runTest1()">Run Test 1</button>
        </div>

        <div class="test-section">
            <h2>Test 2: Credential Management API Support</h2>
            <div id="test2-result"></div>
            <button onclick="runTest2()">Run Test 2</button>
        </div>

        <div class="test-section">
            <h2>Test 3: Form Structure</h2>
            <div id="test3-result"></div>
            <button onclick="runTest3()">Run Test 3</button>
        </div>

        <div class="test-section">
            <h2>Manual Test: Browser Integration</h2>
            <div class="test-result info">
                <strong>Instructions:</strong>
                <ol>
                    <li>Open <a href="login.html" target="_blank">login.html</a> in a new tab</li>
                    <li>Try creating a new account - browser should offer to save the password</li>
                    <li>After saving, logout and return to login page</li>
                    <li>Browser should offer to autofill your credentials</li>
                    <li>If you select the credential, it should attempt auto-login</li>
                </ol>
            </div>
        </div>

        <div class="test-section">
            <h2>All Tests</h2>
            <button onclick="runAllTests()">Run All Automated Tests</button>
            <div id="summary"></div>
        </div>
    </div>

    <script>
        async function runTest1() {
            const result = document.getElementById('test1-result');
            result.innerHTML = '<p>Testing autocomplete attributes...</p>';
            
            try {
                const response = await fetch('login.html');
                const html = await response.text();
                
                const checks = {
                    'Email has autocomplete="username email"': html.includes('autocomplete="username email"'),
                    'Login password has autocomplete="current-password"': html.includes('autocomplete="current-password"'),
                    'Signup password has autocomplete="new-password"': html.includes('autocomplete="new-password"'),
                    'Name has autocomplete="name"': html.includes('autocomplete="name"'),
                    'Inputs have name attributes': html.includes('name="email"') && html.includes('name="password"')
                };
                
                let allPassed = true;
                let output = '';
                for (const [check, passed] of Object.entries(checks)) {
                    output += `<div class="test-result ${passed ? 'pass' : 'fail'}">
                        ${passed ? '‚úì' : '‚úó'} ${check}
                    </div>`;
                    if (!passed) allPassed = false;
                }
                
                result.innerHTML = output + 
                    `<div class="test-result ${allPassed ? 'pass' : 'fail'}">
                        <strong>${allPassed ? '‚úì Test 1 PASSED' : '‚úó Test 1 FAILED'}</strong>
                    </div>`;
                
                return allPassed;
            } catch (error) {
                result.innerHTML = `<div class="test-result fail">Error: ${error.message}</div>`;
                return false;
            }
        }

        async function runTest2() {
            const result = document.getElementById('test2-result');
            result.innerHTML = '<p>Testing Credential Management API support...</p>';
            
            try {
                const response = await fetch('login.html');
                const html = await response.text();
                
                const checks = {
                    'PasswordCredential check exists': html.includes('window.PasswordCredential'),
                    'navigator.credentials.store is used': html.includes('navigator.credentials.store'),
                    'navigator.credentials.get is used': html.includes('navigator.credentials.get'),
                    'Auto-login function exists': html.includes('tryAutoLogin'),
                    'Silent mediation is used': html.includes("mediation: 'silent'"),
                    'Password field not pre-filled': !html.includes("document.getElementById('login-password').value = credential.password")
                };
                
                let allPassed = true;
                let output = '';
                for (const [check, passed] of Object.entries(checks)) {
                    output += `<div class="test-result ${passed ? 'pass' : 'fail'}">
                        ${passed ? '‚úì' : '‚úó'} ${check}
                    </div>`;
                    if (!passed) allPassed = false;
                }
                
                // Check browser support
                const browserSupport = window.PasswordCredential && navigator.credentials;
                output += `<div class="test-result ${browserSupport ? 'pass' : 'info'}">
                    ${browserSupport ? '‚úì' : '‚Ñπ'} Browser supports Credential Management API: ${browserSupport ? 'Yes' : 'No (fallback to standard forms)'}
                </div>`;
                
                result.innerHTML = output + 
                    `<div class="test-result ${allPassed ? 'pass' : 'fail'}">
                        <strong>${allPassed ? '‚úì Test 2 PASSED' : '‚úó Test 2 FAILED'}</strong>
                    </div>`;
                
                return allPassed;
            } catch (error) {
                result.innerHTML = `<div class="test-result fail">Error: ${error.message}</div>`;
                return false;
            }
        }

        async function runTest3() {
            const result = document.getElementById('test3-result');
            result.innerHTML = '<p>Testing form structure...</p>';
            
            try {
                const response = await fetch('login.html');
                const html = await response.text();
                
                const checks = {
                    'Login form has ID': html.includes('id="login-form-element"'),
                    'Signup form has ID': html.includes('id="signup-form-element"'),
                    'Email input has correct type': html.includes('type="email"'),
                    'Password input has correct type': html.includes('type="password"'),
                    'Forms have onsubmit handlers': html.includes('onsubmit="handleLogin(event)"') && html.includes('onsubmit="handleSignup(event)"')
                };
                
                let allPassed = true;
                let output = '';
                for (const [check, passed] of Object.entries(checks)) {
                    output += `<div class="test-result ${passed ? 'pass' : 'fail'}">
                        ${passed ? '‚úì' : '‚úó'} ${check}
                    </div>`;
                    if (!passed) allPassed = false;
                }
                
                result.innerHTML = output + 
                    `<div class="test-result ${allPassed ? 'pass' : 'fail'}">
                        <strong>${allPassed ? '‚úì Test 3 PASSED' : '‚úó Test 3 FAILED'}</strong>
                    </div>`;
                
                return allPassed;
            } catch (error) {
                result.innerHTML = `<div class="test-result fail">Error: ${error.message}</div>`;
                return false;
            }
        }

        async function runAllTests() {
            const summary = document.getElementById('summary');
            summary.innerHTML = '<p>Running all tests...</p>';
            
            const test1 = await runTest1();
            await new Promise(r => setTimeout(r, 500));
            const test2 = await runTest2();
            await new Promise(r => setTimeout(r, 500));
            const test3 = await runTest3();
            
            const passed = [test1, test2, test3].filter(t => t).length;
            const total = 3;
            
            summary.innerHTML = `
                <div class="test-result ${passed === total ? 'pass' : 'fail'}" style="font-size: 1.2em; margin-top: 20px;">
                    <strong>${passed === total ? 'üéâ' : '‚ö†Ô∏è'} Summary: ${passed}/${total} tests passed</strong>
                </div>
            `;
        }
    </script>
</body>
</html>
