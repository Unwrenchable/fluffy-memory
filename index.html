<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medical Assistance Helper - Find Help, Insurance & Support</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="AI-powered medical assistance to help navigate insurance, disability, and healthcare programs. Find free care, doctors, and support.">
    <meta name="theme-color" content="#8b5cf6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="MedHelper">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">
    
    <!-- Icons -->
    <link rel="icon" type="image/svg+xml" href="/icon-192.svg">
    <link rel="apple-touch-icon" href="/icon-192.svg">
    
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- AI-Powered Smart Assistant Widget -->
    <div id="ai-assistant-widget" class="ai-widget">
        <button id="ai-widget-toggle" class="ai-widget-toggle" onclick="toggleAIAssistant()">
            <span class="ai-icon">ü§ñ</span>
            <span class="ai-text">Need Help? Ask AI</span>
        </button>
        <div id="ai-assistant-panel" class="ai-assistant-panel" style="display: none;">
            <div class="ai-panel-header">
                <h3>ü§ñ Your AI Medical Navigator</h3>
                <p>I'll help you cut through the confusion and get the help you need</p>
                <button class="ai-close" onclick="toggleAIAssistant()">√ó</button>
            </div>
            <div id="ai-chat-container" class="ai-chat-container">
                <div class="ai-welcome-message">
                    <p><strong>Hi! I'm your AI assistant.</strong></p>
                    <p>I understand navigating medical assistance can be confusing and frustrating. I'm here to:</p>
                    <ul>
                        <li>‚úÖ Understand exactly what you need</li>
                        <li>‚úÖ Cut through red tape and bureaucracy</li>
                        <li>‚úÖ Help with denials and appeals</li>
                        <li>‚úÖ Find the right doctors and programs</li>
                        <li>‚úÖ Simplify the entire process</li>
                    </ul>
                    <p><strong>What's your situation? Tell me what you're struggling with:</strong></p>
                </div>
                <div id="ai-messages" class="ai-messages"></div>
            </div>
            <div class="ai-quick-actions" id="ai-quick-actions">
                <button onclick="handleQuickAction('confused')" class="quick-action-btn">üòµ I'm Confused</button>
                <button onclick="handleQuickAction('denied')" class="quick-action-btn">‚ùå I Was Denied</button>
                <button onclick="handleQuickAction('start')" class="quick-action-btn">üéØ Where to Start?</button>
                <button onclick="handleQuickAction('appeal')" class="quick-action-btn">‚öñÔ∏è Need to Appeal</button>
            </div>
            <div class="ai-input-area">
                <input type="text" id="ai-user-input" placeholder="Type your question or concern..." onkeypress="handleAIEnter(event)">
                <button onclick="sendToAI()" class="btn-primary">Send</button>
            </div>
        </div>
    </div>

    <header>
        <nav class="navbar">
            <div class="container">
                <h1 class="logo">üè• Medical Assistance Helper</h1>
                <ul class="nav-menu">
                    <li><a href="#universal-help">Get Help</a></li>
                    <li><a href="#location-services">Find Care</a></li>
                    <li><a href="#documents">Documents</a></li>
                    <li><a href="#ai-tools">AI Tools</a></li>
                    <li><a href="donation.html" style="color: #ff69b4; font-weight: bold;">üíù Support Us</a></li>
                    <li><button id="install-pwa-button" class="install-button" style="display: none;">üì± Install App</button></li>
                    <li id="user-nav-item" style="display: none;">
                        <a href="#" onclick="showUserMenu(); return false;" id="user-name-link">üë§ Account</a>
                    </li>
                    <li id="login-nav-item">
                        <a href="login.html" style="color: #8b5cf6; font-weight: bold;">üîê Login</a>
                    </li>
                </ul>
            </div>
        </nav>
        
        <!-- Universal Smart Search Bar -->
        <div class="smart-search-container">
            <div class="container">
                <div class="search-hero">
                    <h2>What do you need help with?</h2>
                    <p>Type anything - we'll figure out what you need</p>
                </div>
                <div class="smart-search-box">
                    <input type="text" 
                           id="smart-search-input" 
                           placeholder='Try: "I was denied" or "I need free dental care" or "I\'m confused"' 
                           onkeyup="handleSmartSearch(event)"
                           autocomplete="off">
                    <button onclick="executeSmartSearch()" class="btn-search">üîç Search</button>
                </div>
                <div id="search-suggestions" class="search-suggestions"></div>
                <div id="search-results-container" style="display: none;"></div>
            </div>
        </div>
    </header>

    <main>
        <!-- Hero Section with AI Prompt -->
        <section class="hero">
            <div class="container">
                <h2>Medical Help for EVERYONE - No Matter Your Situation</h2>
                <p><strong>Confused? Overwhelmed? Ready to give up?</strong> We help ALL people get medical assistance - with ANY condition, ANY situation, even with NO insurance.</p>
                <p style="font-size: 1.1rem; margin-top: 1rem;">‚úÖ Don't understand the process? <strong>We simplify it.</strong><br>
                ‚úÖ Don't know where to start? <strong>We tell you exactly what to do.</strong><br>
                ‚úÖ Been denied? <strong>We help you appeal.</strong><br>
                ‚úÖ Have no insurance? <strong>We find free care.</strong><br>
                ‚úÖ Can't find doctors who help? <strong>We find them for you.</strong></p>
                <button onclick="startComprehensiveIntake()" class="btn-hero">üéØ Start Here - We'll Figure Out What You Need</button>
            </div>
        </section>

        <!-- Universal Help Section - NEW -->
        <section id="universal-help" class="section bg-light">
            <div class="container">
                <h2>üåü This is For YOU - Whatever Your Situation</h2>
                <p class="section-description" style="font-size: 1.2rem; color: #2d3748;"><strong>Don't give up!</strong> Most people who succeed were confused and overwhelmed at first. We make it simple.</p>
                
                <div class="universal-scenarios">
                    <div class="scenario-card">
                        <h3>üòµ "I'm completely confused"</h3>
                        <p>You're not alone! The process IS confusing. We ask you simple questions and tell you exactly what to do step-by-step.</p>
                        <button onclick="startComprehensiveIntake()" class="btn-secondary">Start Simple Questions</button>
                    </div>
                    
                    <div class="scenario-card">
                        <h3>‚ùå "I have NO insurance"</h3>
                        <p>There ARE programs that will help you - FREE or very low cost. We'll show you where to go.</p>
                        <button onclick="showUninsuredPathway()" class="btn-secondary">Show Me Free Care Options</button>
                    </div>
                    
                    <div class="scenario-card">
                        <h3>ü¶∑ "I need dental work but can't afford it"</h3>
                        <p>There are programs that give FREE dental care - extractions, fillings, even dentures. No questions asked.</p>
                        <button onclick="showDentalPathway()" class="btn-secondary">Find Free Dental Care</button>
                    </div>
                    
                    <div class="scenario-card">
                        <h3>üè• "I have a serious condition"</h3>
                        <p>Whether it's cancer, diabetes, heart disease, pain, mental health - we help with ALL conditions.</p>
                        <button onclick="startComprehensiveIntake()" class="btn-secondary">Get Help for My Condition</button>
                    </div>
                    
                    <div class="scenario-card">
                        <h3>üìã "I was denied"</h3>
                        <p>Most successful applicants are denied first! We help you appeal and WIN.</p>
                        <button onclick="startDenialHelp()" class="btn-secondary">Help Me Appeal</button>
                    </div>
                    
                    <div class="scenario-card">
                        <h3>üéØ "Where do I even start?"</h3>
                        <p>Right here! Answer a few questions and we'll create your personal roadmap.</p>
                        <button onclick="startComprehensiveIntake()" class="btn-secondary">Create My Roadmap</button>
                    </div>
                </div>

                <div class="universal-promise">
                    <h3>Our Promise to You:</h3>
                    <ul>
                        <li>‚úÖ <strong>NO medical jargon</strong> - we explain everything in plain English</li>
                        <li>‚úÖ <strong>Step-by-step guidance</strong> - you don't need to figure anything out</li>
                        <li>‚úÖ <strong>For ALL conditions</strong> - physical, mental, rare diseases, chronic pain, EVERYTHING</li>
                        <li>‚úÖ <strong>With or without insurance</strong> - we help everyone</li>
                        <li>‚úÖ <strong>No judgment</strong> - we understand you're struggling</li>
                        <li>‚úÖ <strong>Prevent giving up</strong> - we keep you motivated and on track</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- Location Services Section - NEW -->
        <section id="location-services" class="section">
            <div class="container">
                <h2>üìç Find Help Near YOU</h2>
                <p class="section-description">Enter your location to find the closest free/low-cost medical care, dental clinics, and pharmacies</p>
                
                <div class="location-input-box">
                    <h3>Where are you located?</h3>
                    <div class="location-options">
                        <div class="location-option">
                            <button onclick="requestLocation()" class="btn-primary">üìç Use My Current Location</button>
                            <p style="font-size: 0.9rem; color: #718096; margin-top: 0.5rem;">Fastest way to find help near you</p>
                        </div>
                        <div class="location-option">
                            <p><strong>Or enter manually:</strong></p>
                            <input type="text" id="manual-location" placeholder="Enter ZIP code or city, state">
                            <button onclick="setManualLocation()" class="btn-secondary">Find Near Me</button>
                        </div>
                    </div>
                </div>

                <div id="location-results" style="display: none;">
                    <h3>Closest Resources to You:</h3>
                    <div id="nearest-facilities"></div>
                </div>

                <div class="what-we-find">
                    <h4>What we'll find near you:</h4>
                    <div class="facility-types-grid">
                        <div class="facility-type-card">
                            <span class="facility-icon">üè•</span>
                            <h4>Community Health Centers</h4>
                            <p>Medical, dental, mental health</p>
                            <p><strong>Cost:</strong> $0-$25 based on income</p>
                            <p><strong>Insurance:</strong> Not needed</p>
                        </div>
                        <div class="facility-type-card">
                            <span class="facility-icon">ü¶∑</span>
                            <h4>Free Dental Clinics</h4>
                            <p>Extractions, fillings, cleanings</p>
                            <p><strong>Cost:</strong> FREE</p>
                            <p><strong>Insurance:</strong> Not needed</p>
                        </div>
                        <div class="facility-type-card">
                            <span class="facility-icon">üíä</span>
                            <h4>Low-Cost Pharmacies</h4>
                            <p>$4 generic medications</p>
                            <p><strong>Cost:</strong> $4-$25</p>
                            <p><strong>Insurance:</strong> Not needed</p>
                        </div>
                        <div class="facility-type-card">
                            <span class="facility-icon">üè•</span>
                            <h4>Charity Care Hospitals</h4>
                            <p>Free emergency & hospital care</p>
                            <p><strong>Cost:</strong> FREE if you qualify</p>
                            <p><strong>Insurance:</strong> Not needed</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- AI-Powered Needs Assessment -->
        <section id="ai-guide" class="section">
            <div class="container">
                <h2>üéØ AI-Powered Needs Assessment</h2>
                <p class="section-description">Confused about where to start? Let our AI figure out exactly what you need in 2 minutes</p>
                
                <div class="ai-assessment-box">
                    <div class="assessment-benefits">
                        <h3>Why This Helps:</h3>
                        <ul>
                            <li>‚úÖ <strong>No more confusion</strong> - AI asks the right questions</li>
                            <li>‚úÖ <strong>Personalized path</strong> - Get a roadmap just for you</li>
                            <li>‚úÖ <strong>Avoid denials</strong> - Learn common mistakes before you make them</li>
                            <li>‚úÖ <strong>Track progress</strong> - See exactly where you are in the process</li>
                            <li>‚úÖ <strong>Don't give up</strong> - AI keeps you motivated and on track</li>
                        </ul>
                    </div>
                    <div class="assessment-action">
                        <h3>Take the Quick Assessment</h3>
                        <p>Answer 4 simple questions and get your personalized action plan</p>
                        <button onclick="startAIAssessment()" class="btn-primary btn-large">Start Assessment ‚Üí</button>
                    </div>
                </div>

                <div id="ai-assessment-container" style="display: none;">
                    <!-- Assessment questions will be loaded here -->
                </div>

                <div id="ai-roadmap-container" style="display: none;">
                    <!-- Personalized roadmap will be shown here -->
                </div>
            </div>
        </section>

        <!-- Insurance Search Section -->
        <section id="insurance" class="section">
            <div class="container">
                <h2>üîç Search Insurance & Aid Programs</h2>
                <div class="search-box">
                    <input type="text" id="insurance-input" placeholder="Enter your insurance provider (e.g., Medicare, Medicaid, Blue Cross)">
                    <input type="text" id="condition-input" placeholder="Enter medical condition or treatment needed">
                    <input type="text" id="location-input" placeholder="Enter your ZIP code or city">
                    <button onclick="searchPrograms()" class="btn-primary">Search Programs</button>
                </div>
                <div id="insurance-results" class="results-container"></div>
            </div>
        </section>

        <!-- Paperwork Guidance Section -->
        <section id="paperwork" class="section bg-light">
            <div class="container">
                <h2>üìã Paperwork Guidance & Assistance</h2>
                <p class="section-description">We'll guide you through every form and help you complete necessary documentation</p>
                
                <div class="paperwork-options">
                    <div class="card">
                        <h3>Insurance Applications</h3>
                        <p>Step-by-step help with insurance enrollment forms</p>
                        <button onclick="startPaperwork('insurance')" class="btn-secondary">Start Guide</button>
                    </div>
                    <div class="card">
                        <h3>Medical Records Request</h3>
                        <p>Request and organize your medical documentation</p>
                        <button onclick="startPaperwork('records')" class="btn-secondary">Start Guide</button>
                    </div>
                    <div class="card">
                        <h3>Financial Assistance Forms</h3>
                        <p>Apply for financial aid and support programs</p>
                        <button onclick="startPaperwork('financial')" class="btn-secondary">Start Guide</button>
                    </div>
                    <div class="card">
                        <h3>Treatment Authorization</h3>
                        <p>Get pre-authorization for treatments and procedures</p>
                        <button onclick="startPaperwork('authorization')" class="btn-secondary">Start Guide</button>
                    </div>
                </div>
                
                <div id="paperwork-wizard" class="wizard-container"></div>
            </div>
        </section>

        <!-- Disability Support Section -->
        <section id="disability" class="section">
            <div class="container">
                <h2>‚ôø Disability Support for Rare Conditions</h2>
                <p class="section-description">Specialized assistance for rare conditions and disability benefits</p>
                
                <div class="disability-form">
                    <h3>Find Support for Your Condition</h3>
                    <input type="text" id="rare-condition-input" placeholder="Enter rare condition or diagnosis">
                    <select id="disability-type">
                        <option value="">Select disability type</option>
                        <option value="ssdi">Social Security Disability Insurance (SSDI)</option>
                        <option value="ssi">Supplemental Security Income (SSI)</option>
                        <option value="state">State Disability Programs</option>
                        <option value="private">Private Disability Insurance</option>
                    </select>
                    <button onclick="searchDisabilitySupport()" class="btn-primary">Find Support Resources</button>
                </div>

                <div id="disability-results" class="results-container"></div>

                <div class="info-box">
                    <h4>Common Resources for Rare Conditions:</h4>
                    <ul>
                        <li><strong>National Organization for Rare Disorders (NORD)</strong> - Patient assistance programs</li>
                        <li><strong>Rare Disease Database</strong> - Comprehensive information on rare conditions</li>
                        <li><strong>Social Security Administration</strong> - Disability benefits for qualifying conditions</li>
                        <li><strong>State Vocational Rehabilitation</strong> - Employment support services</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- Doctor Finder Section -->
        <section id="doctors" class="section bg-light">
            <div class="container">
                <h2>üë®‚Äç‚öïÔ∏è Find Disability-Supportive Doctors</h2>
                <p class="section-description"><strong style="color: #e53e3e;">Having trouble finding doctors who will document your disability?</strong> We'll help you find doctors who understand disability evaluations and will properly document your limitations.</p>
                
                <!-- NEW: Doctor Help Tool -->
                <div class="card" style="background: linear-gradient(135deg, rgba(229, 62, 62, 0.1) 0%, rgba(245, 101, 101, 0.1) 100%); border: 2px solid #e53e3e; margin-bottom: 2rem;">
                    <h3>ü©∫ Can't Find Doctors Who Will Document Your Disability?</h3>
                    <p><strong>Common Problem:</strong> "I have a serious condition but no doctor will say on paper that I'm disabled"</p>
                    <p><strong>We can help you:</strong></p>
                    <ul>
                        <li>‚úÖ Find doctors who specialize in disability evaluations</li>
                        <li>‚úÖ Know what questions to ask when calling doctors</li>
                        <li>‚úÖ Document your limitations (even if you can't put them into words)</li>
                        <li>‚úÖ Generate letters to give your doctor explaining what you need</li>
                    </ul>
                    <button onclick="startDoctorFinderTool()" class="btn-primary btn-large">Find Disability-Supportive Doctors</button>
                    <button onclick="startLimitationDocumentor()" class="btn-secondary" style="margin-left: 1rem;">Document My Limitations (No words needed)</button>
                </div>
                
                <div class="doctor-search">
                    <input type="text" id="specialty-input" placeholder="Enter specialty or condition">
                    <input type="text" id="doctor-location-input" placeholder="Enter ZIP code or city">
                    <div class="checkbox-group">
                        <label><input type="checkbox" id="accepts-insurance"> Accepts my insurance</label>
                        <label><input type="checkbox" id="disability-expert"> Disability approval expert</label>
                        <label><input type="checkbox" id="rare-condition-expert"> Rare condition specialist</label>
                    </div>
                    <button onclick="searchDoctors()" class="btn-primary">Search Doctors</button>
                </div>

                <div id="doctor-results" class="results-container"></div>
            </div>
        </section>

        <!-- AI Tools Section -->
        <section id="ai-tools" class="section">
            <div class="container">
                <h2>ü§ñ AI-Powered Assistance Tools</h2>
                <p class="section-description">Advanced AI tools to help with every step of your medical journey</p>
                
                <div class="ai-tools-grid">
                    <div class="card ai-card featured-card">
                        <div class="featured-badge">‚≠ê NEW - Auto-Fill</div>
                        <h3>üìÑ AI Document Upload & Auto-Fill</h3>
                        <p><strong>Upload your documents once, AI fills out ALL your forms!</strong></p>
                        <p>Upload ID, medical records, or any documents - our AI extracts info and auto-fills paperwork for you</p>
                        <button onclick="openAITool('document-autofill')" class="btn-primary">Upload & Auto-Fill</button>
                    </div>

                    <div class="card ai-card">
                        <h3>üìã Smart Form Filler</h3>
                        <p>AI assists in completing medical forms by analyzing your information and suggesting accurate responses</p>
                        <button onclick="openAITool('form-filler')" class="btn-secondary">Launch Tool</button>
                    </div>
                    
                    <div class="card ai-card">
                        <h3>üí¨ Virtual Health Assistant</h3>
                        <p>Chat with AI to get guidance on finding programs, understanding requirements, and next steps</p>
                        <button onclick="openAITool('chat-assistant')" class="btn-secondary">Start Chat</button>
                    </div>
                    
                    <div class="card ai-card">
                        <h3>üîé Document Analyzer</h3>
                        <p>Upload medical documents and get AI-powered analysis and recommendations</p>
                        <button onclick="openAITool('document-analyzer')" class="btn-secondary">Upload Documents</button>
                    </div>
                    
                    <div class="card ai-card">
                        <h3>üìä Coverage Predictor</h3>
                        <p>AI predicts coverage likelihood and suggests best programs for your situation</p>
                        <button onclick="openAITool('coverage-predictor')" class="btn-secondary">Check Coverage</button>
                    </div>

                    <div class="card ai-card">
                        <h3>‚úçÔ∏è Appeal Letter Generator</h3>
                        <p>Generate professional appeal letters for denied claims or applications</p>
                        <button onclick="openAITool('appeal-generator')" class="btn-secondary">Generate Letter</button>
                    </div>

                    <div class="card ai-card">
                        <h3>üìÖ Appointment Coordinator</h3>
                        <p>AI helps schedule and coordinate medical appointments and follow-ups</p>
                        <button onclick="openAITool('appointment-coordinator')" class="btn-secondary">Coordinate Appointments</button>
                    </div>
                </div>

                <div id="ai-tool-modal" class="modal">
                    <div class="modal-content">
                        <span class="close" onclick="closeAITool()">&times;</span>
                        <div id="ai-tool-container"></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Auto-Fill Documents Section -->
        <section id="auto-fill-documents" class="section bg-light">
            <div class="container">
                <h2>üìÑ Smart Document Auto-Fill</h2>
                <p class="section-description">Your questionnaire answers can automatically fill out documents for you!</p>
                
                <!-- Profile Status Card -->
                <div id="profile-status-card" class="card" style="margin-bottom: 2rem;">
                    <div id="profile-status-content">
                        <!-- Will be populated by JavaScript -->
                    </div>
                </div>

                <!-- Document Actions -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1.5rem; margin-top: 2rem;">
                    <div class="card">
                        <h3>üìù Generate Appeal Letter</h3>
                        <p style="font-size: 0.9rem; color: #666; margin-bottom: 1rem;">
                            Auto-fill appeal letter with your questionnaire data
                        </p>
                        <button onclick="generateAutoFilledDocument('appeal-letter')" class="btn-primary" style="width: 100%;">
                            Generate Letter
                        </button>
                    </div>

                    <div class="card">
                        <h3>üë®‚Äç‚öïÔ∏è Doctor Request Letter</h3>
                        <p style="font-size: 0.9rem; color: #666; margin-bottom: 1rem;">
                            Request letter with your information pre-filled
                        </p>
                        <button onclick="generateAutoFilledDocument('doctor-request')" class="btn-primary" style="width: 100%;">
                            Generate Letter
                        </button>
                    </div>

                    <div class="card">
                        <h3>üìã RFC Request Letter</h3>
                        <p style="font-size: 0.9rem; color: #666; margin-bottom: 1rem;">
                            RFC form request with your details
                        </p>
                        <button onclick="generateAutoFilledDocument('rfc-request')" class="btn-primary" style="width: 100%;">
                            Generate Letter
                        </button>
                    </div>

                    <div class="card">
                        <h3>üè• Medical Records Request</h3>
                        <p style="font-size: 0.9rem; color: #666; margin-bottom: 1rem;">
                            Records request with your information
                        </p>
                        <button onclick="generateAutoFilledDocument('medical-records-request')" class="btn-primary" style="width: 100%;">
                            Generate Request
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- AI Configuration Section -->
        <section id="ai-config" class="section">
            <div class="container">
                <h2>‚öôÔ∏è AI Configuration</h2>
                <p class="section-description">Configure your AI assistants (X.AI + HuggingFace) to get advanced help</p>
                
                <div class="config-info-box" style="background: #fff3cd; border-left: 4px solid #ffc107; padding: 1rem; margin-bottom: 2rem; border-radius: 8px;">
                    <h4>üîí Your API Keys are Secure</h4>
                    <p style="margin: 0.5rem 0;">‚Ä¢ API keys are stored only in your browser's memory (not saved to disk)</p>
                    <p style="margin: 0.5rem 0;">‚Ä¢ They are NEVER sent to our servers or saved permanently</p>
                    <p style="margin: 0.5rem 0;">‚Ä¢ You'll need to re-enter them each session</p>
                    <p style="margin: 0.5rem 0;">‚Ä¢ See <code>.env.example</code> file for server-side configuration</p>
                </div>

                <div class="config-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem;">
                    <!-- X.AI Configuration -->
                    <div class="card">
                        <h3>ü§ñ X.AI (Grok) Configuration</h3>
                        <p style="font-size: 0.9rem; color: #666; margin-bottom: 1rem;">
                            Advanced conversational AI for complex medical guidance and reasoning
                        </p>
                        <div style="margin-bottom: 1rem;">
                            <label for="xai-api-key" style="display: block; margin-bottom: 0.5rem; font-weight: bold;">API Key:</label>
                            <input 
                                type="password" 
                                id="xai-api-key" 
                                placeholder="xai-..." 
                                style="width: 100%; padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px;">
                            <small style="color: #666;">Get your key from <a href="https://console.x.ai/" target="_blank">console.x.ai</a></small>
                        </div>
                        <div style="margin-bottom: 1rem;">
                            <label style="display: flex; align-items: center; cursor: pointer;">
                                <input type="checkbox" id="xai-enabled" checked style="margin-right: 0.5rem;">
                                <span>Enable X.AI</span>
                            </label>
                        </div>
                        <div id="xai-status" style="padding: 0.5rem; border-radius: 4px; font-size: 0.9rem; margin-top: 1rem;">
                            ‚ö™ Not configured
                        </div>
                    </div>

                    <!-- HuggingFace Configuration -->
                    <div class="card">
                        <h3>ü§ó HuggingFace Configuration</h3>
                        <p style="font-size: 0.9rem; color: #666; margin-bottom: 1rem;">
                            Specialized AI models for document analysis, summarization, and medical text processing
                        </p>
                        <div style="margin-bottom: 1rem;">
                            <label for="hf-api-key" style="display: block; margin-bottom: 0.5rem; font-weight: bold;">API Key:</label>
                            <input 
                                type="password" 
                                id="hf-api-key" 
                                placeholder="hf_..." 
                                style="width: 100%; padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px;">
                            <small style="color: #666;">Get your key from <a href="https://huggingface.co/settings/tokens" target="_blank">huggingface.co/settings/tokens</a></small>
                        </div>
                        <div style="margin-bottom: 1rem;">
                            <label style="display: flex; align-items: center; cursor: pointer;">
                                <input type="checkbox" id="hf-enabled" checked style="margin-right: 0.5rem;">
                                <span>Enable HuggingFace</span>
                            </label>
                        </div>
                        <div id="hf-status" style="padding: 0.5rem; border-radius: 4px; font-size: 0.9rem; margin-top: 1rem;">
                            ‚ö™ Not configured
                        </div>
                    </div>
                </div>

                <!-- Team Mode Configuration -->
                <div class="card" style="margin-top: 2rem;">
                    <h3>üéØ AI Team Mode</h3>
                    <p style="margin-bottom: 1rem;">Choose how your AI assistants work together:</p>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                        <label class="mode-option" style="padding: 1rem; border: 2px solid #ddd; border-radius: 8px; cursor: pointer; transition: all 0.3s;">
                            <input type="radio" name="team-mode" value="auto" checked style="margin-right: 0.5rem;">
                            <strong>Auto</strong>
                            <p style="font-size: 0.85rem; color: #666; margin: 0.5rem 0 0 0;">Smart routing to best AI</p>
                        </label>
                        <label class="mode-option" style="padding: 1rem; border: 2px solid #ddd; border-radius: 8px; cursor: pointer; transition: all 0.3s;">
                            <input type="radio" name="team-mode" value="xai-only" style="margin-right: 0.5rem;">
                            <strong>X.AI Only</strong>
                            <p style="font-size: 0.85rem; color: #666; margin: 0.5rem 0 0 0;">Use only Grok</p>
                        </label>
                        <label class="mode-option" style="padding: 1rem; border: 2px solid #ddd; border-radius: 8px; cursor: pointer; transition: all 0.3s;">
                            <input type="radio" name="team-mode" value="huggingface-only" style="margin-right: 0.5rem;">
                            <strong>HuggingFace Only</strong>
                            <p style="font-size: 0.85rem; color: #666; margin: 0.5rem 0 0 0;">Use only HF models</p>
                        </label>
                        <label class="mode-option" style="padding: 1rem; border: 2px solid #ddd; border-radius: 8px; cursor: pointer; transition: all 0.3s;">
                            <input type="radio" name="team-mode" value="both" style="margin-right: 0.5rem;">
                            <strong>Both</strong>
                            <p style="font-size: 0.85rem; color: #666; margin: 0.5rem 0 0 0;">Get responses from both</p>
                        </label>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div style="margin-top: 2rem; text-align: center;">
                    <button onclick="saveAIConfig()" class="btn-primary" style="margin: 0 0.5rem;">üíæ Save Configuration</button>
                    <button onclick="testAIConfig()" class="btn-secondary" style="margin: 0 0.5rem;">üß™ Test AI Connection</button>
                    <button onclick="clearAIConfig()" class="btn-secondary" style="margin: 0 0.5rem;">üóëÔ∏è Clear Keys</button>
                </div>

                <div id="config-message" style="margin-top: 1rem; padding: 1rem; border-radius: 8px; display: none;"></div>
            </div>
        </section>

        <!-- Quick Links Section -->
        <section class="section">
            <div class="container">
                <h2>üîó Quick Access Resources</h2>
                <div class="quick-links">
                    <a href="#" class="quick-link-card" onclick="externalLink('healthcare.gov')">
                        <h4>Healthcare.gov</h4>
                        <p>Federal health insurance marketplace</p>
                    </a>
                    <a href="#" class="quick-link-card" onclick="externalLink('ssa.gov')">
                        <h4>Social Security</h4>
                        <p>Disability benefits and SSI</p>
                    </a>
                    <a href="#" class="quick-link-card" onclick="externalLink('medicaid.gov')">
                        <h4>Medicaid</h4>
                        <p>State health coverage programs</p>
                    </a>
                    <a href="#" class="quick-link-card" onclick="externalLink('medicare.gov')">
                        <h4>Medicare</h4>
                        <p>Federal health insurance</p>
                    </a>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2026 Medical Assistance Helper. This tool provides guidance only and does not constitute medical or legal advice.</p>
            <p>Always consult with qualified professionals for your specific situation.</p>
        </div>
    </footer>

    <!-- User Menu Modal -->
    <div id="user-menu-modal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 500px;">
            <span class="close" onclick="closeUserMenu()">&times;</span>
            <div id="user-menu-content">
                <h2>üë§ My Account</h2>
                <div id="user-info" style="margin: 1.5rem 0;">
                    <p><strong>Name:</strong> <span id="user-display-name"></span></p>
                    <p><strong>Email:</strong> <span id="user-display-email"></span></p>
                    <p><strong>Member since:</strong> <span id="user-display-since"></span></p>
                </div>
                
                <div style="margin: 2rem 0;">
                    <h3>üìÑ My Saved Documents (<span id="doc-count">0</span>)</h3>
                    <div id="user-documents-list" style="max-height: 300px; overflow-y: auto; margin-top: 1rem;">
                        <!-- Documents will be listed here -->
                    </div>
                </div>
                
                <div style="margin-top: 2rem; display: flex; gap: 1rem;">
                    <button onclick="handleLogout()" class="btn-secondary" style="flex: 1;">
                        üö™ Logout
                    </button>
                    <button onclick="closeUserMenu()" class="btn-primary" style="flex: 1;">
                        Close
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="auth.js"></script>
    <script src="email-system.js"></script>
    <script src="location-services.js"></script>
    <script src="comprehensive-intake.js"></script>
    <script src="user-data-manager.js"></script>
    <script src="condition-categorizer.js"></script>
    <script src="config.js"></script>
    <script src="xai-huggingface-integration.js"></script>
    <script src="ai-assistant.js"></script>
    <script src="disability-doctor-finder.js"></script>
    <script src="document-library.js"></script>
    <script src="smart-search.js"></script>
    <script src="crypto-payment.js"></script>
    <script src="pwa-install.js"></script>
    <script src="script.js"></script>
    <script>
        // Initialize user authentication UI
        function initUserAuth() {
            const userNavItem = document.getElementById('user-nav-item');
            const loginNavItem = document.getElementById('login-nav-item');
            const userNameLink = document.getElementById('user-name-link');
            
            if (window.authSystem && window.authSystem.isLoggedIn()) {
                const user = window.authSystem.getCurrentUser();
                if (user) {
                    // Show user menu, hide login
                    userNavItem.style.display = 'block';
                    loginNavItem.style.display = 'none';
                    userNameLink.textContent = `üë§ ${user.name.split(' ')[0]}`;
                    
                    // Auto-save progress periodically
                    startAutoSave();
                }
            } else {
                // Show login, hide user menu
                userNavItem.style.display = 'none';
                loginNavItem.style.display = 'block';
            }
        }
        
        // Show user menu
        function showUserMenu() {
            if (!window.authSystem || !window.authSystem.isLoggedIn()) {
                window.location.href = 'login.html';
                return;
            }
            
            const user = window.authSystem.getCurrentUser();
            const modal = document.getElementById('user-menu-modal');
            
            // Update user info
            document.getElementById('user-display-name').textContent = user.name;
            document.getElementById('user-display-email').textContent = user.email;
            document.getElementById('user-display-since').textContent = new Date(user.createdAt).toLocaleDateString();
            
            // Load saved documents
            const documents = window.authSystem.getSavedDocuments();
            document.getElementById('doc-count').textContent = documents.length;
            
            const docsList = document.getElementById('user-documents-list');
            if (documents.length === 0) {
                docsList.innerHTML = '<p style="color: #718096; text-align: center; padding: 1rem;">No saved documents yet</p>';
            } else {
                docsList.innerHTML = documents.map(doc => `
                    <div style="background: #f7fafc; padding: 1rem; margin-bottom: 0.5rem; border-radius: 8px; display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <strong>${doc.name}</strong>
                            <p style="color: #718096; font-size: 0.9rem; margin: 0.25rem 0 0 0;">
                                Saved: ${new Date(doc.savedAt).toLocaleDateString()}
                            </p>
                        </div>
                        <button onclick="emailDocument('${doc.id}')" class="btn-secondary" style="padding: 0.5rem 1rem;">
                            üìß Email
                        </button>
                    </div>
                `).join('');
            }
            
            modal.style.display = 'flex';
        }
        
        // Close user menu
        function closeUserMenu() {
            document.getElementById('user-menu-modal').style.display = 'none';
        }
        
        // Handle logout
        function handleLogout() {
            if (confirm('Are you sure you want to logout? Make sure your progress is saved.')) {
                window.authSystem.logout();
                window.location.href = 'index.html';
            }
        }
        
        // Email a document
        function emailDocument(docId) {
            const documents = window.authSystem.getSavedDocuments();
            const doc = documents.find(d => d.id === docId);
            
            if (doc && window.emailSystem) {
                const user = window.authSystem.getCurrentUser();
                window.emailSystem.showEmailDialog(doc, user);
            }
        }
        
        // Auto-save progress periodically
        let autoSaveInterval = null;
        const AUTO_SAVE_INTERVAL_MS = 2 * 60 * 1000; // 2 minutes
        
        function startAutoSave() {
            // Save progress every 2 minutes
            if (autoSaveInterval) {
                clearInterval(autoSaveInterval);
            }
            
            autoSaveInterval = setInterval(() => {
                if (window.authSystem && window.authSystem.isLoggedIn()) {
                    // Collect current progress data
                    const progressData = {
                        lastVisit: new Date().toISOString(),
                        currentPage: window.location.pathname
                    };
                    
                    window.authSystem.saveProgress(progressData);
                    console.log('Progress auto-saved');
                }
            }, AUTO_SAVE_INTERVAL_MS);
        }
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', initUserAuth);
        
        // ============================================
        // AI Configuration Functions
        // ============================================
        
        // Initialize AI configuration system
        window.appConfig = new AppConfig();
        window.aiTeam = new DualAIMedicalTeam();
        
        function initAIConfig() {
            // Ensure global access for script.js
            if (!window.appConfig) {
                window.appConfig = new AppConfig();
            }
            if (!window.aiTeam) {
                window.aiTeam = new DualAIMedicalTeam();
            }
            
            // Load saved configuration
            const config = window.appConfig.getConfig();
            
            // Update UI based on saved settings
            document.getElementById('xai-enabled').checked = config.xai.enabled;
            document.getElementById('hf-enabled').checked = config.huggingface.enabled;
            
            // Set team mode radio button
            const modeRadios = document.querySelectorAll('input[name="team-mode"]');
            modeRadios.forEach(radio => {
                if (radio.value === config.teamMode) {
                    radio.checked = true;
                }
            });
            
            // Update status displays
            updateConfigStatus();
            
            // If keys are already set, configure the AI team
            if (appConfig.isConfigured('xai') || appConfig.isConfigured('huggingface')) {
                aiTeam.setApiKeys(
                    appConfig.getApiKey('xai'),
                    appConfig.getApiKey('huggingface')
                );
                aiTeam.setTeamMode(appConfig.getTeamMode());
            }
        }
        
        // Save AI configuration
        function saveAIConfig() {
            const xaiKey = document.getElementById('xai-api-key').value.trim();
            const hfKey = document.getElementById('hf-api-key').value.trim();
            const xaiEnabled = document.getElementById('xai-enabled').checked;
            const hfEnabled = document.getElementById('hf-enabled').checked;
            const teamMode = document.querySelector('input[name="team-mode"]:checked').value;
            
            let hasError = false;
            let errorMessage = '';
            
            // Validate X.AI key if provided
            if (xaiKey) {
                const validation = window.appConfig.validateApiKey('xai', xaiKey);
                if (!validation.valid) {
                    hasError = true;
                    errorMessage += `X.AI: ${validation.error}\n`;
                }
            }
            
            // Validate HuggingFace key if provided
            if (hfKey) {
                const validation = window.appConfig.validateApiKey('huggingface', hfKey);
                if (!validation.valid) {
                    hasError = true;
                    errorMessage += `HuggingFace: ${validation.error}\n`;
                }
            }
            
            // Check if at least one key is provided
            if (!xaiKey && !hfKey) {
                showConfigMessage('Please provide at least one API key to enable AI assistance.', 'warning');
                return;
            }
            
            if (hasError) {
                showConfigMessage(errorMessage, 'error');
                return;
            }
            
            // Save API keys (in memory only)
            window.appConfig.setApiKeys(xaiKey || null, hfKey || null);
            
            // Save preferences (without keys)
            window.appConfig.setTeamMode(teamMode);
            window.appConfig.config.xai.enabled = xaiEnabled;
            window.appConfig.config.huggingface.enabled = hfEnabled;
            window.appConfig.saveConfig();
            
            // Configure AI team
            window.aiTeam.setApiKeys(
                xaiKey || null,
                hfKey || null
            );
            window.aiTeam.setTeamMode(teamMode);
            
            // Update window.aiAssistant to use the new dual AI system
            if (window.aiAssistant) {
                window.aiAssistant.dualAI = aiTeam;
                window.aiAssistant.useDualAI = true;
            }
            
            // Update status
            updateConfigStatus();
            
            showConfigMessage('‚úÖ AI configuration saved successfully! Your AI assistants are now active.', 'success');
        }
        
        // Test AI configuration
        async function testAIConfig() {
            if (!window.aiTeam) {
                showConfigMessage('Please configure your AI first.', 'warning');
                return;
            }
            
            const status = window.aiTeam.getStatus();
            
            if (!status.xaiConfigured && !status.huggingFaceConfigured) {
                showConfigMessage('Please configure at least one API key first.', 'warning');
                return;
            }
            
            showConfigMessage('üß™ Testing AI connection...', 'info');
            
            try {
                const testQuery = 'Hello, this is a test. Please respond briefly.';
                const response = await window.aiTeam.getTeamResponse(testQuery);
                
                if (response && !response.error) {
                    showConfigMessage(`‚úÖ Test successful!\n\nSource: ${response.source}\nResponse: ${response.response.substring(0, 100)}...`, 'success');
                } else {
                    showConfigMessage(`‚ùå Test failed: ${response.response}`, 'error');
                }
            } catch (error) {
                showConfigMessage(`‚ùå Test failed: ${error.message}`, 'error');
            }
        }
        
        // Clear AI configuration
        function clearAIConfig() {
            if (confirm('Are you sure you want to clear all AI API keys? This will only clear them from memory.')) {
                document.getElementById('xai-api-key').value = '';
                document.getElementById('hf-api-key').value = '';
                
                if (window.appConfig) {
                    window.appConfig.clearApiKeys();
                }
                
                if (window.aiTeam) {
                    window.aiTeam.clearHistory();
                }
                
                updateConfigStatus();
                showConfigMessage('üóëÔ∏è API keys cleared from memory.', 'info');
            }
        }
        
        // Update configuration status displays
        function updateConfigStatus() {
            const xaiStatus = document.getElementById('xai-status');
            const hfStatus = document.getElementById('hf-status');
            
            if (window.appConfig) {
                // X.AI status
                if (window.appConfig.isConfigured('xai')) {
                    xaiStatus.innerHTML = '‚úÖ Configured and ready';
                    xaiStatus.style.background = '#d4edda';
                    xaiStatus.style.color = '#155724';
                } else {
                    xaiStatus.innerHTML = '‚ö™ Not configured';
                    xaiStatus.style.background = '#f8f9fa';
                    xaiStatus.style.color = '#6c757d';
                }
                
                // HuggingFace status
                if (window.appConfig.isConfigured('huggingface')) {
                    hfStatus.innerHTML = '‚úÖ Configured and ready';
                    hfStatus.style.background = '#d4edda';
                    hfStatus.style.color = '#155724';
                } else {
                    hfStatus.innerHTML = '‚ö™ Not configured';
                    hfStatus.style.background = '#f8f9fa';
                    hfStatus.style.color = '#6c757d';
                }
            }
        }
        
        // Show configuration message
        function showConfigMessage(message, type) {
            const msgDiv = document.getElementById('config-message');
            msgDiv.style.display = 'block';
            msgDiv.textContent = message;
            
            // Set style based on type
            switch (type) {
                case 'success':
                    msgDiv.style.background = '#d4edda';
                    msgDiv.style.color = '#155724';
                    msgDiv.style.border = '1px solid #c3e6cb';
                    break;
                case 'error':
                    msgDiv.style.background = '#f8d7da';
                    msgDiv.style.color = '#721c24';
                    msgDiv.style.border = '1px solid #f5c6cb';
                    break;
                case 'warning':
                    msgDiv.style.background = '#fff3cd';
                    msgDiv.style.color = '#856404';
                    msgDiv.style.border = '1px solid #ffeaa7';
                    break;
                case 'info':
                    msgDiv.style.background = '#d1ecf1';
                    msgDiv.style.color = '#0c5460';
                    msgDiv.style.border = '1px solid #bee5eb';
                    break;
            }
            
            // Auto-hide success messages after 5 seconds
            if (type === 'success' || type === 'info') {
                setTimeout(() => {
                    msgDiv.style.display = 'none';
                }, 5000);
            }
        }
        
        // ============================================
        // Auto-Fill Documents Functions
        // ============================================
        
        // Initialize UserDataManager
        let userDataManager = null;
        
        function initAutoFillSystem() {
            userDataManager = new UserDataManager();
            updateProfileStatusDisplay();
        }
        
        // Update profile status display
        function updateProfileStatusDisplay() {
            const statusContent = document.getElementById('profile-status-content');
            if (!statusContent) return;
            
            if (userDataManager && userDataManager.hasProfile()) {
                const summary = userDataManager.getProfileSummary();
                statusContent.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <div style="font-size: 3rem;">‚úÖ</div>
                        <div style="flex: 1;">
                            <h3 style="margin: 0 0 0.5rem 0; color: #155724;">Profile Complete!</h3>
                            <p style="margin: 0; color: #155724;">
                                <strong>Name:</strong> ${summary.name} | 
                                <strong>State:</strong> ${summary.state} | 
                                <strong>Condition:</strong> ${summary.primaryCondition}
                            </p>
                            <p style="margin: 0.5rem 0 0 0; font-size: 0.9rem; color: #666;">
                                Your documents will be automatically filled with information from your questionnaire.
                            </p>
                        </div>
                        <button onclick="clearProfile()" class="btn-secondary" style="white-space: nowrap;">
                            Clear Profile
                        </button>
                    </div>
                `;
            } else {
                statusContent.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <div style="font-size: 3rem;">‚ö†Ô∏è</div>
                        <div style="flex: 1;">
                            <h3 style="margin: 0 0 0.5rem 0; color: #856404;">No Profile Found</h3>
                            <p style="margin: 0; color: #856404;">
                                Complete the comprehensive questionnaire to enable auto-fill.
                            </p>
                            <p style="margin: 0.5rem 0 0 0; font-size: 0.9rem; color: #666;">
                                The 7-section questionnaire takes 5-10 minutes and saves all your information for automatic document filling.
                            </p>
                        </div>
                        <button onclick="startComprehensiveIntake()" class="btn-primary" style="white-space: nowrap;">
                            Start Questionnaire
                        </button>
                    </div>
                `;
            }
        }
        
        // Generate auto-filled document
        function generateAutoFilledDocument(templateId) {
            if (!userDataManager || !userDataManager.hasProfile()) {
                alert('Please complete the comprehensive questionnaire first to enable auto-fill.');
                startComprehensiveIntake();
                return;
            }
            
            // Get document library
            const docLib = new DocumentLibrary();
            
            // Fill template with user data
            const filledDocument = docLib.fillTemplate(templateId, null); // null = use stored data
            
            if (!filledDocument) {
                alert('Error: Document template not found.');
                return;
            }
            
            // Display the filled document
            showFilledDocument(templateId, filledDocument);
        }
        
        // Show filled document in a modal
        function showFilledDocument(templateId, content) {
            const templateNames = {
                'appeal-letter': 'Appeal Letter',
                'doctor-request': 'Doctor Request Letter',
                'rfc-request': 'RFC Request Letter',
                'medical-records-request': 'Medical Records Request'
            };
            
            const modalHtml = `
                <div id="document-modal" class="modal" style="display: block;">
                    <div class="modal-content" style="max-width: 800px; max-height: 80vh; overflow: auto;">
                        <span class="close" onclick="closeDocumentModal()">&times;</span>
                        <h2>üìÑ ${templateNames[templateId] || 'Document'}</h2>
                        <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px; margin: 1rem 0;">
                            <p style="margin: 0; color: #666; font-size: 0.9rem;">
                                ‚ú® This document has been auto-filled with your questionnaire data. 
                                Review and edit as needed before copying or printing.
                            </p>
                        </div>
                        <textarea id="filled-document-content" 
                                  style="width: 100%; min-height: 400px; padding: 1rem; 
                                         font-family: monospace; border: 1px solid #ddd; 
                                         border-radius: 4px; resize: vertical;">${content}</textarea>
                        <div style="margin-top: 1rem; display: flex; gap: 1rem; flex-wrap: wrap;">
                            <button onclick="copyDocumentToClipboard()" class="btn-primary">
                                üìã Copy to Clipboard
                            </button>
                            <button onclick="downloadDocument('${templateId}')" class="btn-secondary">
                                üíæ Download as TXT
                            </button>
                            <button onclick="printDocument()" class="btn-secondary">
                                üñ®Ô∏è Print
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            // Add modal to page
            const existingModal = document.getElementById('document-modal');
            if (existingModal) {
                existingModal.remove();
            }
            document.body.insertAdjacentHTML('beforeend', modalHtml);
        }
        
        // Close document modal
        function closeDocumentModal() {
            const modal = document.getElementById('document-modal');
            if (modal) {
                modal.remove();
            }
        }
        
        // Copy document to clipboard
        function copyDocumentToClipboard() {
            const textarea = document.getElementById('filled-document-content');
            if (textarea) {
                textarea.select();
                document.execCommand('copy');
                alert('‚úÖ Document copied to clipboard!');
            }
        }
        
        // Download document
        function downloadDocument(templateId) {
            const textarea = document.getElementById('filled-document-content');
            if (!textarea) return;
            
            const content = textarea.value;
            const blob = new Blob([content], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${templateId}-${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }
        
        // Print document
        function printDocument() {
            const textarea = document.getElementById('filled-document-content');
            if (!textarea) return;
            
            const content = textarea.value;
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                <head>
                    <title>Print Document</title>
                    <style>
                        body { font-family: Arial, sans-serif; padding: 2rem; line-height: 1.6; }
                        pre { white-space: pre-wrap; word-wrap: break-word; }
                    </style>
                </head>
                <body>
                    <pre>${content}</pre>
                </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }
        
        // Clear user profile
        function clearProfile() {
            if (confirm('Are you sure you want to clear your saved profile data? This cannot be undone.')) {
                if (userDataManager) {
                    userDataManager.clearProfile();
                    updateProfileStatusDisplay();
                    alert('‚úÖ Profile data cleared.');
                }
            }
        }
        
        // Start comprehensive intake
        function startComprehensiveIntake() {
            // Scroll to the intake section or open it in a modal
            alert('The comprehensive intake questionnaire would open here. This connects to the existing intake system.');
            // In production, this would trigger the actual intake flow
        }
        
        // ============================================
        // Smart Search Integration
        // ============================================
        
        // Initialize Smart Search System
        let smartSearchSystem = null;
        
        function initSmartSearch() {
            if (typeof SmartSearchSystem !== 'undefined') {
                smartSearchSystem = new SmartSearchSystem();
                console.log('Smart Search System initialized');
            } else {
                console.warn('SmartSearchSystem class not available');
            }
        }
        
        // Handle real-time search as user types
        function handleSmartSearch(event) {
            const query = event.target.value.trim();
            const suggestionsContainer = document.getElementById('search-suggestions');
            
            if (!smartSearchSystem) {
                initSmartSearch();
            }
            
            // Clear suggestions if query is too short
            if (query.length < 2) {
                if (suggestionsContainer) {
                    suggestionsContainer.innerHTML = '';
                    suggestionsContainer.style.display = 'none';
                }
                return;
            }
            
            // Get autocomplete suggestions
            if (smartSearchSystem) {
                const suggestions = smartSearchSystem.getAutocompleteSuggestions(query);
                displaySuggestions(suggestions);
            }
            
            // Execute search on Enter key
            if (event.key === 'Enter') {
                executeSmartSearch();
            }
        }
        
        // Display autocomplete suggestions
        function displaySuggestions(suggestions) {
            const suggestionsContainer = document.getElementById('search-suggestions');
            if (!suggestionsContainer) return;
            
            if (suggestions.length === 0) {
                suggestionsContainer.style.display = 'none';
                return;
            }
            
            const html = suggestions.map(suggestion => 
                `<div class="suggestion-item" onclick="fillSearchQuery('${suggestion.replace(/'/g, "\\'")}')">${suggestion}</div>`
            ).join('');
            
            suggestionsContainer.innerHTML = html;
            suggestionsContainer.style.display = 'block';
        }
        
        // Fill search query from suggestion
        function fillSearchQuery(suggestion) {
            const input = document.getElementById('smart-search-input');
            if (input) {
                input.value = suggestion;
                executeSmartSearch();
            }
        }
        
        // Execute the search
        function executeSmartSearch() {
            const input = document.getElementById('smart-search-input');
            const resultsContainer = document.getElementById('search-results-container');
            const suggestionsContainer = document.getElementById('search-suggestions');
            
            if (!input || !resultsContainer) return;
            
            const query = input.value.trim();
            
            // Hide suggestions
            if (suggestionsContainer) {
                suggestionsContainer.style.display = 'none';
            }
            
            // Clear results if query is empty
            if (query.length === 0) {
                resultsContainer.style.display = 'none';
                return;
            }
            
            if (!smartSearchSystem) {
                initSmartSearch();
            }
            
            if (!smartSearchSystem) {
                console.error('Smart Search System not available');
                return;
            }
            
            // Analyze the search query
            const analysis = smartSearchSystem.analyzeSearch(query);
            
            // Search documents if document library is available
            let documentResults = [];
            if (window.documentLibrary) {
                documentResults = smartSearchSystem.searchDocuments(query, window.documentLibrary);
            }
            
            // Generate and display results
            const results = smartSearchSystem.generateSearchResults(analysis, documentResults);
            displaySearchResults(results);
        }
        
        // Display search results
        function displaySearchResults(results) {
            const resultsContainer = document.getElementById('search-results-container');
            if (!resultsContainer) return;
            
            let html = '<div class="search-results">';
            
            // Message
            if (results.message) {
                html += `<div class="search-message">${results.message}</div>`;
            }
            
            // Primary action
            if (results.primaryAction) {
                html += `
                    <div class="search-primary-action">
                        <div class="action-icon">${results.primaryAction.icon}</div>
                        <div class="action-content">
                            <h3>${results.primaryAction.title}</h3>
                            <p>${results.primaryAction.description}</p>
                            <button onclick="executeAction('${results.primaryAction.action}')" class="btn-primary">
                                ${results.primaryAction.title}
                            </button>
                        </div>
                    </div>
                `;
            }
            
            // Related actions
            if (results.relatedActions && results.relatedActions.length > 0) {
                html += '<div class="search-related-actions"><h4>Related Options:</h4>';
                results.relatedActions.forEach(action => {
                    html += `
                        <div class="related-action-item" onclick="executeAction('${action.action}')">
                            <span class="action-icon">${action.icon}</span>
                            <span>${action.title}</span>
                        </div>
                    `;
                });
                html += '</div>';
            }
            
            // Document results
            if (results.documents && results.documents.length > 0) {
                html += '<div class="search-documents"><h4>Related Documents:</h4>';
                results.documents.forEach(doc => {
                    html += `
                        <div class="document-item" onclick="openDocument('${doc.id}')">
                            <span class="doc-icon">üìÑ</span>
                            <div>
                                <strong>${doc.title}</strong>
                                <p>${doc.description || ''}</p>
                            </div>
                        </div>
                    `;
                });
                html += '</div>';
            }
            
            // Suggestions
            if (results.suggestions && results.suggestions.length > 0) {
                html += '<div class="search-suggestions-results"><h4>You might also want to:</h4>';
                results.suggestions.forEach(suggestion => {
                    html += `
                        <div class="suggestion-result-item" onclick="executeAction('${suggestion.action}')">
                            <span class="suggestion-icon">${suggestion.icon}</span>
                            <span>${suggestion.text}</span>
                        </div>
                    `;
                });
                html += '</div>';
            }
            
            html += '</div>';
            
            resultsContainer.innerHTML = html;
            resultsContainer.style.display = 'block';
            resultsContainer.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }
        
        // Execute an action based on the action type
        function executeAction(action) {
            console.log('Executing action:', action);
            
            switch(action) {
                case 'start_intake':
                    startComprehensiveIntake();
                    break;
                case 'show_document_library':
                    if (window.documentLibrary) {
                        window.documentLibrary.showLibrary();
                    }
                    break;
                case 'show_doctor_finder':
                    if (window.disabilityDoctorFinder) {
                        window.disabilityDoctorFinder.showFinder();
                    }
                    break;
                case 'show_location_services':
                    if (window.locationServices) {
                        window.locationServices.findNearbyServices();
                    }
                    break;
                case 'open_ai_chat':
                    if (window.aiAssistant) {
                        window.aiAssistant.openChat();
                    }
                    break;
                default:
                    alert(`Action "${action}" will be implemented soon. This would trigger the ${action} feature.`);
            }
        }
        
        // Open a document
        function openDocument(docId) {
            if (window.documentLibrary) {
                window.documentLibrary.openDocument(docId);
            }
        }
        
        // Initialize AI config when page loads
        document.addEventListener('DOMContentLoaded', () => {
            initAIConfig();
            initAutoFillSystem();
            initSmartSearch();
        });
    </script>
</body>
</html>
